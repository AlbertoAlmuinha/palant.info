---
author: Wladimir Palant
id: "000001"
---

<p>Unfortunately, I didn&#8217;t make notes last time I looked into this &#8211; the issues simply weren&#8217;t serious enough for reporting. And I only looked at a small portion of the codebase, so when I look at it now it will probably be some different code paths. So the <code>getDomain()</code> function I see under <a href="https://github.com/bitwarden/jslib/blob/dd46d5ecdd51f91dace5488272dd1f7bafd995c5/src/misc/utils.ts#L169" rel="nofollow">https://github.com/bitwarden/jslib/blob/dd46d5ecdd51f91dace5488272dd1f7bafd995c5/src/misc/utils.ts#L169</a> is indeed using <code>URL</code> objects. It also knows that tld.js won&#8217;t handle IP addresses correctly, but it will only consider IPv4 addresses in dotted decimal notation and not IPv4 addresses in other notations or IPv6 addresses. All of that appears to be a minor risk but not an actual issue &#8211; assuming that <span class="caps">URL</span>s are already normalized when they get here (ok, let&#8217;s ignore the code prefixing <span class="caps">URL</span>s with <code>http://</code> here).</p>

<p>The code at the bottom of this function is quite problematic however. Rather than ignoring non-<span class="caps">HTTP</span> <span class="caps">URL</span>s, this function will pass them to tld.js. But tld.js isn&#8217;t aware that non-<span class="caps">HTTP</span> <span class="caps">URL</span>s can have different semantics, so it will happily return “example.com” when it is fed something like “data://example.com,asdf/”. Oops, I think that one might even be exploitable&#8230;</p>

<p>I think I&#8217;m going to stop here. This needs a structured effort, not spending ten minutes every now and then. As I said, the codebase isn&#8217;t bad. But there are obvious issues that shouldn&#8217;t have been there. As always, spotting the issues is the easy part &#8211; proving that they are exploitable is far harder. I&#8217;m not going to spend time on that right now, so let&#8217;s just file these under “minor quality issues” rather than “security problems.”</p>